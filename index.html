<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Autolink | รักออม Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --accent: #f472b6; --bg-light: #fff5f7; }
        body { background: var(--bg-light); font-family: 'Inter', sans-serif; overflow-x: hidden; }
        .glass { background: rgba(255, 255, 255, 0.9); box-shadow: 0 8px 32px rgba(244, 114, 182, 0.1); border: 1px solid rgba(255, 255, 255, 0.8); }
        .love-text { text-shadow: 0 10px 20px rgba(244, 114, 182, 0.4); }
        @keyframes heartBeat { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        .animate-love { animation: heartBeat 2s infinite ease-in-out; }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <div class="w-full py-10 flex justify-center items-center bg-white/50 backdrop-blur-md">
        <h1 class="text-7xl md:text-[12rem] font-black italic tracking-tighter text-transparent bg-clip-text bg-gradient-to-r from-pink-500 via-red-500 to-rose-400 love-text animate-love">
            รักออม
        </h1>
    </div>

    <nav class="h-16 border-b border-pink-100 flex items-center justify-between px-8 bg-white/80 sticky top-0 z-50">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-gradient-to-br from-pink-500 to-rose-500 rounded-xl flex items-center justify-center shadow-lg">
                <i class="fas fa-heart text-white animate-bounce"></i>
            </div>
            <h1 class="font-black italic text-gray-800 uppercase">Autolink <span class="text-pink-500 font-light">PRO</span></h1>
        </div>
        <div id="status" class="text-[10px] font-bold px-4 py-1.5 rounded-full border border-pink-200 text-pink-600 bg-pink-50">CONNECTING...</div>
    </nav>

    <main class="flex-1 p-4 md:p-8 grid grid-cols-12 gap-6">
        <div class="col-span-12 lg:col-span-4 glass p-8 rounded-[3rem] flex flex-col items-center">
            <p class="text-pink-400 text-xs font-bold tracking-widest uppercase mb-4">Temperature</p>
            <div id="gauge-container" class="w-full"></div>
            <h2 id="live-value" class="text-7xl font-black text-pink-600 mt-[-40px]">--.-</h2>
        </div>

        <div class="col-span-12 lg:col-span-8 glass p-8 rounded-[3rem]">
            <h3 class="text-xs font-bold text-gray-400 uppercase mb-4">Live Telemetry</h3>
            <div id="main-chart"></div>
        </div>

        <div class="col-span-12 lg:col-span-6 grid grid-cols-2 gap-4">
            <button onclick="publishCmd('ON')" class="p-8 bg-pink-500 text-white rounded-[2rem] shadow-xl active:scale-95 transition-all font-black italic text-2xl">START</button>
            <button onclick="publishCmd('OFF')" class="p-8 bg-white border-2 border-pink-100 text-pink-500 rounded-[2rem] shadow-lg active:scale-95 transition-all font-black italic text-2xl">STOP</button>
        </div>

        <div class="col-span-12 lg:col-span-6 glass p-8 rounded-[2rem]">
            <input type="range" id="threshold" min="0" max="100" value="75" class="w-full accent-pink-500">
            <div class="flex justify-between mt-4 font-mono font-bold text-pink-600 uppercase">
                <span>Min</span> <span id="thresh-val">75%</span> <span>Max</span>
            </div>
        </div>
    </main>

    <script>
        const socket = io(); // สำหรับ Deploy ให้ใส่ URL ของ Render ที่นี่

        const gauge = new ApexCharts(document.querySelector("#gauge-container"), {
            chart: { height: 300, type: 'radialBar' },
            series: [0],
            plotOptions: { radialBar: { startAngle: -135, endAngle: 135, track: { background: '#ffe4e6' }, dataLabels: { show: false } } },
            colors: ['#ec4899']
        });
        gauge.render();

        const chart = new ApexCharts(document.querySelector("#main-chart"), {
            chart: { height: 250, type: 'area', toolbar: false, animations: { enabled: true, easing: 'linear', dynamicAnimation: { speed: 800 } } },
            series: [{ name: 'Temp', data: [] }],
            xaxis: { type: 'datetime', range: 60000 },
            colors: ['#ec4899'],
            fill: { type: 'gradient', gradient: { opacityFrom: 0.4, opacityTo: 0 } }
        });
        chart.render();

        socket.on('telemetry_stream', (data) => {
            const val = parseFloat(data.value).toFixed(1);
            document.getElementById('live-value').innerText = val;
            gauge.updateSeries([val]);
            chart.appendData([{ data: [{ x: new Date().getTime(), y: val }] }]);
        });

        const publishCmd = (cmd) => socket.emit('control_device', { deviceId: 'ESP32_01', command: cmd });

        document.getElementById('threshold').oninput = function() {
            document.getElementById('thresh-val').innerText = this.value + "%";
            socket.emit('set_threshold', { value: this.value });
        };

        socket.on('connect', () => {
            document.getElementById('status').innerText = "SYSTEM ACTIVE";
            document.getElementById('status').className = "text-[10px] font-bold px-4 py-1.5 rounded-full border border-green-200 text-green-600 bg-green-50";
        });
    </script>
</body>
</html>